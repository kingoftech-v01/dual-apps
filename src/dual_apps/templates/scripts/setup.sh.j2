#!/bin/bash
# Setup script for {{ project_name }}
# Generated by dual-apps v{{ version }}
#
# Usage: ./scripts/setup.sh

set -e

echo "ğŸš€ Setting up {{ project_name }}..."

# Create virtual environment if it doesn't exist
if [ ! -d ".venv" ]; then
    echo "ğŸ“¦ Creating virtual environment..."
    python -m venv .venv
fi

# Activate virtual environment
source .venv/bin/activate

# Install dependencies
echo "ğŸ“¦ Installing dependencies..."
pip install --upgrade pip
pip install -r requirements/dev.in

# Install pre-commit hooks
echo "ğŸ”§ Installing pre-commit hooks..."
pre-commit install

# Copy environment file
if [ ! -f ".env" ]; then
    echo "ğŸ“„ Creating .env file..."
    cp .env.example .env
fi

# Start database if using Docker
if command -v docker-compose &> /dev/null; then
    echo "ğŸ³ Starting database..."
    docker-compose up -d db redis
    sleep 3
fi

# Run migrations
echo "ğŸ—ƒï¸ Running migrations..."
python manage.py migrate

# Create demo data
echo "ğŸ“Š Creating demo data..."
{% for app in apps %}
python manage.py demo_{{ app }} --count=10
{% endfor %}

# Run tests
echo "ğŸ§ª Running tests..."
pytest --cov=apps --cov-report=term-missing

echo ""
echo "âœ… Setup complete!"
echo ""
echo "Next steps:"
echo "  1. docker-compose up    # Start all services"
echo "  2. python manage.py runserver"
echo "  3. Open http://localhost:8000"
echo ""
echo "URLs:"
{% for app in apps %}
echo "  - http://localhost:8000/{{ app }}/"
{% endfor %}
echo "  - http://localhost:8000/api/v1/"
echo "  - http://localhost:8000/admin/"
