#!/bin/bash
# Security audit script for {{ project_name }}
# Generated by dual-apps v{{ version }}
#
# Usage: ./scripts/security-audit.sh

set -e

echo "üîí Running security audit for {{ project_name }}..."
echo ""

# Install security tools
pip install safety bandit pip-audit 2>/dev/null

# Check dependencies for vulnerabilities
echo "üì¶ Checking dependencies (safety)..."
safety check --full-report || true
echo ""

echo "üì¶ Checking dependencies (pip-audit)..."
pip-audit || true
echo ""

# Run bandit code analysis
echo "üîç Running code security scan (bandit)..."
bandit -r {{ project_name }} apps -f txt || true
echo ""

# Check Django security settings
echo "‚öôÔ∏è Checking Django security settings..."
python manage.py check --deploy 2>/dev/null || echo "Run with proper settings for full check"
echo ""

# Check for hardcoded secrets
echo "üîë Checking for hardcoded secrets..."
grep -rn "SECRET_KEY\s*=\s*['\"]" --include="*.py" . 2>/dev/null && echo "‚ö†Ô∏è Found hardcoded secrets!" || echo "‚úÖ No hardcoded secrets found"
grep -rn "password\s*=\s*['\"]" --include="*.py" . 2>/dev/null && echo "‚ö†Ô∏è Found hardcoded passwords!" || echo "‚úÖ No hardcoded passwords found"
echo ""

# Summary
echo "=========================================="
echo "üîí Security Audit Complete"
echo "=========================================="
echo ""
echo "Checklist:"
echo "  [ ] Review safety/pip-audit findings"
echo "  [ ] Review bandit findings"
echo "  [ ] Verify HTTPS in production"
echo "  [ ] Verify security headers"
echo "  [ ] Run: python manage.py check --deploy"
echo ""
echo "Documentation: docs/SECURITY.md"
