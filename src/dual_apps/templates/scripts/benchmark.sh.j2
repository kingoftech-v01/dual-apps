#!/bin/bash
# Benchmark script for {{ project_name }}
# Generated by dual-apps v{{ version }}
#
# Usage: ./scripts/benchmark.sh

set -e

echo "ðŸ“Š Running benchmarks for {{ project_name }}..."

# Check if locust is installed
if ! command -v locust &> /dev/null; then
    echo "Installing locust..."
    pip install locust
fi

# Create locustfile if it doesn't exist
if [ ! -f "locustfile.py" ]; then
cat > locustfile.py << 'EOF'
from locust import HttpUser, task, between

class {{ project_name_pascal }}User(HttpUser):
    wait_time = between(1, 3)

    @task(3)
    def list_items(self):
        {% for app in apps %}
        self.client.get("/{{ app }}/")
        {% endfor %}

    @task(2)
    def api_list(self):
        {% for app in apps %}
        self.client.get("/api/v1/{{ app }}/")
        {% endfor %}

    @task(1)
    def api_detail(self):
        # Assumes demo data exists
        pass
EOF
fi

echo "Starting benchmark..."
echo "Open http://localhost:8089 to view results"
echo ""

# Run locust
locust -f locustfile.py --host=http://localhost:8000 --headless -u 100 -r 10 -t 60s

echo ""
echo "Benchmark complete!"
echo ""
echo "Targets:"
echo "  - Requests/sec: 250+"
echo "  - P95 latency: <200ms"
echo "  - Error rate: <1%"
