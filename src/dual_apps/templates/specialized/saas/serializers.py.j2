"""
SaaS serializers for {{ app_name }} app.
Generated by dual-apps v{{ version }}
"""

from rest_framework import serializers
from .models import (
    Organization, OrganizationMember, OrganizationInvite,
    Plan, Subscription, Invoice, PaymentMethod, UsageRecord, APIKey
)


class OrganizationSerializer(serializers.ModelSerializer):
    class Meta:
        model = Organization
        fields = [
            'id', 'name', 'slug', 'logo', 'is_active', 'is_verified',
            'max_users', 'max_storage_gb', 'current_users',
            'created_at', 'updated_at'
        ]
        read_only_fields = ['id', 'created_at', 'updated_at']


class OrganizationMemberSerializer(serializers.ModelSerializer):
    username = serializers.CharField(source='user.username', read_only=True)

    class Meta:
        model = OrganizationMember
        fields = ['id', 'organization', 'user', 'username', 'role', 'joined_at', 'created_at']
        read_only_fields = ['id', 'created_at']


class OrganizationInviteSerializer(serializers.ModelSerializer):
    is_expired = serializers.BooleanField(read_only=True)

    class Meta:
        model = OrganizationInvite
        fields = [
            'id', 'organization', 'email', 'role', 'token',
            'expires_at', 'accepted_at', 'is_expired', 'created_at'
        ]
        read_only_fields = ['id', 'token', 'is_expired', 'created_at']


class PlanSerializer(serializers.ModelSerializer):
    class Meta:
        model = Plan
        fields = [
            'id', 'name', 'slug', 'description', 'price', 'interval', 'currency',
            'max_users', 'max_storage_gb', 'max_projects', 'features',
            'is_active', 'is_featured', 'order'
        ]


class SubscriptionSerializer(serializers.ModelSerializer):
    plan_name = serializers.CharField(source='plan.name', read_only=True)
    is_active = serializers.BooleanField(read_only=True)
    is_trialing = serializers.BooleanField(read_only=True)
    days_until_renewal = serializers.IntegerField(read_only=True)

    class Meta:
        model = Subscription
        fields = [
            'id', 'organization', 'plan', 'plan_name', 'status',
            'trial_ends_at', 'current_period_start', 'current_period_end',
            'is_active', 'is_trialing', 'days_until_renewal', 'created_at'
        ]
        read_only_fields = ['id', 'created_at']


class InvoiceSerializer(serializers.ModelSerializer):
    class Meta:
        model = Invoice
        fields = [
            'id', 'organization', 'invoice_number', 'status', 'currency',
            'subtotal', 'tax', 'total', 'amount_paid', 'amount_due',
            'invoice_date', 'due_date', 'paid_at', 'pdf_url', 'created_at'
        ]
        read_only_fields = ['id', 'created_at']
