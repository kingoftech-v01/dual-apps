{% raw %}{% extends "blog/base_blog.html" %}

{% block title %}{{ page_title|default:"Blog" }} - {{ project_name_display }}{% endblock %}

{% block content %}
<div class="{% if css_framework == 'tailwind' %}grid grid-cols-1 lg:grid-cols-3 gap-8{% else %}row{% endif %}">
    <!-- Main Content -->
    <div class="{% if css_framework == 'tailwind' %}lg:col-span-2{% else %}col-lg-8{% endif %}">
        <h1 class="{% if css_framework == 'tailwind' %}text-3xl font-bold mb-6{% else %}mb-4{% endif %}">
            {{ page_title|default:"Latest Posts" }}
        </h1>

        {% if filter_type %}
        <div class="{% if css_framework == 'tailwind' %}bg-gray-100 rounded-lg p-4 mb-6 flex justify-between items-center{% else %}alert alert-light d-flex justify-content-between align-items-center{% endif %}">
            <span>
                {% if filter_type == 'category' %}Browsing: <strong>{{ filter_value }}</strong>
                {% elif filter_type == 'tag' %}Tagged: <strong>{{ filter_value }}</strong>
                {% elif filter_type == 'search' %}Results for: <strong>"{{ filter_value }}"</strong>
                {% endif %}
            </span>
            <a href="{% url 'blog:post_list' %}" class="{% if css_framework == 'tailwind' %}text-blue-600 hover:text-blue-800{% else %}btn btn-sm btn-outline-secondary{% endif %}">
                Clear
            </a>
        </div>
        {% endif %}

        <div id="posts-container">
            {% for post in posts %}
            <article class="{% if css_framework == 'tailwind' %}bg-white rounded-lg shadow mb-6 overflow-hidden{% else %}card mb-4{% endif %}">
                <div class="{% if css_framework == 'tailwind' %}flex{% else %}row g-0{% endif %}">
                    {% if post.featured_image %}
                    <div class="{% if css_framework == 'tailwind' %}w-1/3 flex-shrink-0{% else %}col-md-4{% endif %}">
                        <a href="{% url 'blog:post_detail' post.slug %}">
                            <img src="{{ post.featured_image.url }}" alt="{{ post.title }}"
                                 class="{% if css_framework == 'tailwind' %}h-full w-full object-cover{% else %}img-fluid rounded-start h-100{% endif %}"
                                 style="{% if css_framework != 'tailwind' %}object-fit: cover;{% endif %}">
                        </a>
                    </div>
                    {% endif %}
                    <div class="{% if css_framework == 'tailwind' %}{% if post.featured_image %}w-2/3{% else %}w-full{% endif %} p-6{% else %}{% if post.featured_image %}col-md-8{% else %}col-12{% endif %}{% endif %}">
                        <div class="{% if css_framework != 'tailwind' %}card-body{% endif %}">
                            {% if post.category %}
                            <a href="{% url 'blog:category' post.category.slug %}"
                               class="{% if css_framework == 'tailwind' %}inline-block bg-blue-100 text-blue-800 text-xs px-2 py-1 rounded{% else %}badge bg-primary text-decoration-none{% endif %}">
                                {{ post.category.name }}
                            </a>
                            {% endif %}

                            <h2 class="{% if css_framework == 'tailwind' %}text-xl font-bold mt-2 mb-2{% else %}card-title h4 mt-2{% endif %}">
                                <a href="{% url 'blog:post_detail' post.slug %}"
                                   class="{% if css_framework == 'tailwind' %}text-gray-900 hover:text-blue-600{% else %}text-decoration-none text-dark{% endif %}">
                                    {{ post.title }}
                                </a>
                            </h2>

                            <p class="{% if css_framework == 'tailwind' %}text-gray-600 mb-4{% else %}card-text text-muted{% endif %}">
                                {{ post.excerpt|truncatewords:30 }}
                            </p>

                            <div class="{% if css_framework == 'tailwind' %}flex items-center justify-between{% else %}d-flex justify-content-between align-items-center{% endif %}">
                                <div class="{% if css_framework == 'tailwind' %}flex items-center{% else %}d-flex align-items-center{% endif %}">
                                    {% if post.author.profile.avatar %}
                                    <img src="{{ post.author.profile.avatar.url }}"
                                         class="{% if css_framework == 'tailwind' %}w-8 h-8 rounded-full mr-2{% else %}rounded-circle me-2{% endif %}"
                                         alt="{{ post.author.get_full_name }}" style="{% if css_framework != 'tailwind' %}width: 32px; height: 32px; object-fit: cover;{% endif %}">
                                    {% endif %}
                                    <a href="{% url 'blog:author' post.author.username %}"
                                       class="{% if css_framework == 'tailwind' %}text-sm text-gray-600 hover:text-gray-900{% else %}text-muted text-decoration-none small{% endif %}">
                                        {{ post.author.get_full_name|default:post.author.username }}
                                    </a>
                                </div>
                                <span class="{% if css_framework == 'tailwind' %}text-sm text-gray-500{% else %}text-muted small{% endif %}">
                                    {{ post.published_at|date:"M d, Y" }} ¬∑ {{ post.reading_time }} min read
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
            </article>
            {% empty %}
            <div class="{% if css_framework == 'tailwind' %}text-center py-12{% else %}text-center py-5{% endif %}">
                <div class="{% if css_framework == 'tailwind' %}text-6xl mb-4{% else %}mb-4{% endif %}" style="font-size: 5rem;">üìù</div>
                <h3>No posts found</h3>
                <p class="{% if css_framework == 'tailwind' %}text-gray-500{% else %}text-muted{% endif %}">
                    Check back later for new content!
                </p>
            </div>
            {% endfor %}
        </div>

        <!-- Load More with HTMX -->
        {% if posts.has_next %}
        <div id="load-more" class="{% if css_framework == 'tailwind' %}text-center mt-8{% else %}text-center mt-4{% endif %}">
            <button hx-get="{% url 'blog:post_list' %}?page={{ posts.next_page_number }}{% if request.GET.q %}&q={{ request.GET.q }}{% endif %}"
                    hx-target="#posts-container"
                    hx-swap="beforeend"
                    hx-indicator="#loading"
                    class="{% if css_framework == 'tailwind' %}px-6 py-3 bg-blue-600 text-white rounded-lg hover:bg-blue-700{% else %}btn btn-primary{% endif %}">
                Load More Posts
            </button>
            <div id="loading" class="htmx-indicator {% if css_framework == 'tailwind' %}mt-4{% else %}mt-3{% endif %}">
                Loading...
            </div>
        </div>
        {% endif %}
    </div>

    <!-- Sidebar -->
    <aside class="{% if css_framework != 'tailwind' %}col-lg-4{% endif %}">
        <!-- Categories -->
        <div class="{% if css_framework == 'tailwind' %}bg-white rounded-lg shadow p-6 mb-6{% else %}card mb-4{% endif %}">
            <div class="{% if css_framework != 'tailwind' %}card-header{% endif %}">
                <h6 class="{% if css_framework == 'tailwind' %}font-bold mb-4{% else %}mb-0{% endif %}">Categories</h6>
            </div>
            <div class="{% if css_framework != 'tailwind' %}card-body{% endif %}"
                 hx-get="{% url 'blog:categories_widget' %}" hx-trigger="load">
                <!-- Categories loaded via HTMX -->
            </div>
        </div>

        <!-- Popular Posts -->
        <div class="{% if css_framework == 'tailwind' %}bg-white rounded-lg shadow p-6 mb-6{% else %}card mb-4{% endif %}">
            <div class="{% if css_framework != 'tailwind' %}card-header{% endif %}">
                <h6 class="{% if css_framework == 'tailwind' %}font-bold mb-4{% else %}mb-0{% endif %}">Popular Posts</h6>
            </div>
            <div class="{% if css_framework != 'tailwind' %}card-body{% endif %}"
                 hx-get="{% url 'blog:popular_posts_widget' %}" hx-trigger="load">
                <!-- Popular posts loaded via HTMX -->
            </div>
        </div>

        <!-- Tags -->
        <div class="{% if css_framework == 'tailwind' %}bg-white rounded-lg shadow p-6{% else %}card{% endif %}">
            <div class="{% if css_framework != 'tailwind' %}card-header{% endif %}">
                <h6 class="{% if css_framework == 'tailwind' %}font-bold mb-4{% else %}mb-0{% endif %}">Tags</h6>
            </div>
            <div class="{% if css_framework != 'tailwind' %}card-body{% endif %}"
                 hx-get="{% url 'blog:tags_widget' %}" hx-trigger="load">
                <!-- Tags loaded via HTMX -->
            </div>
        </div>
    </aside>
</div>

<style>
.htmx-indicator { display: none; }
.htmx-request .htmx-indicator { display: block; }
</style>
{% endblock %}
{% endraw %}
