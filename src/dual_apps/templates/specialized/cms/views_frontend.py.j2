"""
CMS frontend views for {{ app_name }} app.
Generated by dual-apps v{{ version }}
"""

from django.shortcuts import render, get_object_or_404
from django.views.generic import ListView, DetailView
from django.http import Http404

from .models import Page, PageBlock, Menu


class PageListView(ListView):
    """List all published pages."""
    model = Page
    template_name = "{{ app_name }}/page_list.html"
    context_object_name = "pages"

    def get_queryset(self):
        return Page.objects.filter(status='published', parent__isnull=True)


class PageDetailView(DetailView):
    """View single page by slug."""
    model = Page
    template_name = "{{ app_name }}/page_detail.html"
    context_object_name = "page"
    slug_field = "slug"

    def get_queryset(self):
        return Page.objects.filter(status='published')

    def get_context_data(self, **kwargs):
        context = super().get_context_data(**kwargs)
        context['children'] = self.object.children.filter(status='published')
        return context


def page_by_path(request, path):
    """Render page by URL path."""
    slug = path.rstrip('/').split('/')[-1] if path else 'home'
    page = get_object_or_404(Page, slug=slug, status='published')
    return render(request, page.get_template(), {'page': page})


# URL name mappings
page_list = PageListView.as_view()
page_detail = PageDetailView.as_view()
