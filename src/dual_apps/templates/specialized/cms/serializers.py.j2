"""
CMS serializers for {{ app_name }} app.
Generated by dual-apps v{{ version }}
"""

from rest_framework import serializers
from .models import Page, PageBlock, Menu, MenuItem, MediaFile, MediaFolder, Form, FormField


class PageBlockSerializer(serializers.ModelSerializer):
    class Meta:
        model = PageBlock
        fields = ['id', 'page', 'block_type', 'title', 'content', 'settings', 'order', 'is_active']


class PageSerializer(serializers.ModelSerializer):
    blocks = PageBlockSerializer(many=True, read_only=True)
    full_path = serializers.CharField(read_only=True)

    class Meta:
        model = Page
        fields = [
            'id', 'title', 'slug', 'content', 'parent', 'template',
            'meta_title', 'meta_description', 'status', 'published_at',
            'show_in_nav', 'is_homepage', 'order', 'full_path', 'blocks',
            'created_at', 'updated_at'
        ]
        read_only_fields = ['id', 'created_at', 'updated_at']


class MenuItemSerializer(serializers.ModelSerializer):
    link = serializers.CharField(read_only=True)
    children = serializers.SerializerMethodField()

    class Meta:
        model = MenuItem
        fields = ['id', 'menu', 'title', 'url', 'page', 'target', 'icon', 'order', 'is_active', 'link', 'children']

    def get_children(self, obj):
        children = obj.children.filter(is_active=True)
        return MenuItemSerializer(children, many=True).data


class MenuSerializer(serializers.ModelSerializer):
    items = serializers.SerializerMethodField()

    class Meta:
        model = Menu
        fields = ['id', 'name', 'slug', 'location', 'items']

    def get_items(self, obj):
        items = obj.items.filter(parent__isnull=True, is_active=True)
        return MenuItemSerializer(items, many=True).data


class MediaFileSerializer(serializers.ModelSerializer):
    class Meta:
        model = MediaFile
        fields = [
            'id', 'name', 'file', 'file_type', 'folder', 'alt_text',
            'caption', 'mime_type', 'file_size', 'width', 'height',
            'created_at'
        ]
        read_only_fields = ['id', 'created_at']


class FormFieldSerializer(serializers.ModelSerializer):
    class Meta:
        model = FormField
        fields = [
            'id', 'form', 'field_type', 'name', 'label', 'placeholder',
            'help_text', 'default_value', 'choices', 'is_required', 'order'
        ]


class FormSerializer(serializers.ModelSerializer):
    fields = FormFieldSerializer(many=True, read_only=True)

    class Meta:
        model = Form
        fields = ['id', 'name', 'slug', 'description', 'success_message', 'redirect_url', 'is_active', 'fields']
