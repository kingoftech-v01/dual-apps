{% raw %}/**
 * Product Card Component for {{ project_name_display }}
 */
import React, { useState } from 'react';
import { Link } from 'react-router-dom';
import { useWishlist } from '../../context/WishlistContext';

function ProductCard({ product, onAddToCart }) {
  const { toggleWishlist, isInWishlist } = useWishlist();
  const [isAddingToCart, setIsAddingToCart] = useState(false);
  const [isWishlisted, setIsWishlisted] = useState(isInWishlist(product.id));

  const handleAddToCart = async (e) => {
    e.preventDefault();
    if (isAddingToCart || !product.in_stock) return;

    setIsAddingToCart(true);
    try {
      await onAddToCart();
    } finally {
      setIsAddingToCart(false);
    }
  };

  const handleToggleWishlist = async (e) => {
    e.preventDefault();
    const result = await toggleWishlist(product.id);
    if (result.success) {
      setIsWishlisted(!isWishlisted);
    }
  };

  const renderStars = (rating) => {
    return [...Array(5)].map((_, i) => (
      <span key={i} className={i < Math.round(rating) ? 'text-warning' : 'text-muted'}>
        {i < Math.round(rating) ? '‚òÖ' : '‚òÜ'}
      </span>
    ));
  };

  return (
{% if css_framework == 'tailwind' %}
    <div className="bg-white rounded-lg shadow-md overflow-hidden hover:shadow-lg transition-shadow">
      <div className="relative">
        <Link to={`/products/${product.slug}`}>
          {product.image ? (
            <img
              src={product.image}
              alt={product.name}
              className="w-full h-48 object-cover"
              loading="lazy"
            />
          ) : (
            <div className="w-full h-48 bg-gray-200 flex items-center justify-center">
              <span className="text-gray-400">No image</span>
            </div>
          )}
        </Link>

        {product.sale_price && (
          <span className="absolute top-2 left-2 bg-red-500 text-white text-xs px-2 py-1 rounded">
            Sale
          </span>
        )}

        <button
          onClick={handleToggleWishlist}
          className={`absolute top-2 right-2 p-2 bg-white rounded-full shadow hover:bg-gray-100 ${isWishlisted ? 'text-red-500' : 'text-gray-400'}`}
        >
          {isWishlisted ? '‚ù§Ô∏è' : 'ü§ç'}
        </button>
      </div>

      <div className="p-4">
        <Link
          to={`/products/${product.slug}`}
          className="text-lg font-semibold text-gray-900 hover:text-blue-600 line-clamp-2"
        >
          {product.name}
        </Link>

        <div className="flex items-center mt-2">
          <span className="text-yellow-400">
            {renderStars(product.avg_rating || 0)}
          </span>
          <span className="text-gray-500 text-sm ml-2">
            ({product.review_count || 0})
          </span>
        </div>

        <div className="flex items-center justify-between mt-4">
          <div>
            {product.sale_price ? (
              <>
                <span className="text-lg font-bold text-gray-900">${product.sale_price}</span>
                <span className="text-sm text-gray-500 line-through ml-2">${product.price}</span>
              </>
            ) : (
              <span className="text-lg font-bold text-gray-900">${product.price}</span>
            )}
          </div>

          {product.in_stock ? (
            <button
              onClick={handleAddToCart}
              disabled={isAddingToCart}
              className={`bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 disabled:opacity-50 ${isAddingToCart ? 'cursor-not-allowed' : ''}`}
            >
              {isAddingToCart ? '...' : 'Add'}
            </button>
          ) : (
            <span className="text-gray-500 text-sm">Out of Stock</span>
          )}
        </div>
      </div>
    </div>
{% else %}
    <div className="card h-100">
      <div className="position-relative">
        <Link to={`/products/${product.slug}`}>
          {product.image ? (
            <img
              src={product.image}
              alt={product.name}
              className="card-img-top"
              style={{ height: 200, objectFit: 'cover' }}
              loading="lazy"
            />
          ) : (
            <div className="bg-light d-flex align-items-center justify-content-center" style={{ height: 200 }}>
              <span className="text-muted">No image</span>
            </div>
          )}
        </Link>

        {product.sale_price && (
          <span className="badge bg-danger position-absolute top-0 start-0 m-2">Sale</span>
        )}

        <button
          onClick={handleToggleWishlist}
          className={`btn btn-sm btn-light position-absolute top-0 end-0 m-2 ${isWishlisted ? 'text-danger' : ''}`}
        >
          {isWishlisted ? '‚ù§Ô∏è' : 'ü§ç'}
        </button>
      </div>

      <div className="card-body">
        <Link to={`/products/${product.slug}`} className="h6 card-title text-decoration-none">
          {product.name}
        </Link>

        <div className="mt-2">
          <span className="text-warning">
            {renderStars(product.avg_rating || 0)}
          </span>
          <small className="text-muted ms-2">({product.review_count || 0})</small>
        </div>

        <div className="d-flex justify-content-between align-items-center mt-3">
          <div>
            {product.sale_price ? (
              <>
                <span className="h5 mb-0">${product.sale_price}</span>
                <small className="text-muted text-decoration-line-through ms-2">${product.price}</small>
              </>
            ) : (
              <span className="h5 mb-0">${product.price}</span>
            )}
          </div>

          {product.in_stock ? (
            <button
              onClick={handleAddToCart}
              disabled={isAddingToCart}
              className="btn btn-primary btn-sm"
            >
              {isAddingToCart ? '...' : 'Add'}
            </button>
          ) : (
            <span className="badge bg-secondary">Out of Stock</span>
          )}
        </div>
      </div>
    </div>
{% endif %}
  );
}

export default ProductCard;
{% endraw %}
