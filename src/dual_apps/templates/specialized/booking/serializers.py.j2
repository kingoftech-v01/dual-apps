"""
Booking serializers for {{ app_name }} app.
Generated by dual-apps v{{ version }}
"""

from rest_framework import serializers
from .models import (
    ServiceCategory, Service, Staff, Resource,
    Availability, Booking, BookingPayment, BookingReview
)


class ServiceCategorySerializer(serializers.ModelSerializer):
    class Meta:
        model = ServiceCategory
        fields = ['id', 'name', 'slug', 'description', 'image', 'order', 'is_active']


class ServiceSerializer(serializers.ModelSerializer):
    category_name = serializers.CharField(source='category.name', read_only=True)
    total_duration = serializers.IntegerField(read_only=True)

    class Meta:
        model = Service
        fields = [
            'id', 'name', 'slug', 'description', 'short_description', 'image',
            'category', 'category_name', 'duration_minutes', 'price',
            'deposit_amount', 'deposit_required', 'max_participants',
            'buffer_before', 'buffer_after', 'total_duration',
            'is_active', 'is_featured', 'requires_approval'
        ]


class StaffSerializer(serializers.ModelSerializer):
    name = serializers.SerializerMethodField()
    services = ServiceSerializer(many=True, read_only=True)

    class Meta:
        model = Staff
        fields = ['id', 'name', 'bio', 'photo', 'phone', 'email', 'services', 'is_active']

    def get_name(self, obj):
        return obj.user.get_full_name() or obj.user.username


class ResourceSerializer(serializers.ModelSerializer):
    class Meta:
        model = Resource
        fields = ['id', 'name', 'description', 'capacity', 'is_active']


class AvailabilitySerializer(serializers.ModelSerializer):
    day_name = serializers.CharField(source='get_day_of_week_display', read_only=True)

    class Meta:
        model = Availability
        fields = ['id', 'staff', 'day_of_week', 'day_name', 'start_time', 'end_time', 'is_available']


class BookingPaymentSerializer(serializers.ModelSerializer):
    class Meta:
        model = BookingPayment
        fields = ['id', 'booking', 'payment_type', 'amount', 'method', 'transaction_id', 'status', 'created_at']


class BookingSerializer(serializers.ModelSerializer):
    service_name = serializers.CharField(source='service.name', read_only=True)
    staff_name = serializers.SerializerMethodField()
    is_past = serializers.BooleanField(read_only=True)
    can_cancel = serializers.BooleanField(read_only=True)
    payments = BookingPaymentSerializer(many=True, read_only=True)

    class Meta:
        model = Booking
        fields = [
            'id', 'customer', 'customer_name', 'customer_email', 'customer_phone',
            'service', 'service_name', 'staff', 'staff_name', 'resource',
            'start_datetime', 'end_datetime', 'duration_minutes', 'participants',
            'status', 'price', 'deposit_paid', 'total_paid',
            'customer_notes', 'staff_notes', 'is_past', 'can_cancel',
            'payments', 'created_at'
        ]
        read_only_fields = ['id', 'customer', 'created_at']

    def get_staff_name(self, obj):
        if obj.staff:
            return obj.staff.user.get_full_name() or obj.staff.user.username
        return None


class BookingReviewSerializer(serializers.ModelSerializer):
    class Meta:
        model = BookingReview
        fields = ['id', 'booking', 'rating', 'comment', 'is_approved', 'created_at']
        read_only_fields = ['id', 'is_approved', 'created_at']
