"""
Models for {{ app_name }} app.

Following Django best practices:
- UUID primary keys (secure, distributed-friendly)
- Timestamps (created_at, updated_at)
- Soft delete (is_active field)
- Owner relationship for permissions

Generated by dual-apps v{{ version }}
"""

import uuid
from django.db import models
from django.conf import settings
from django.urls import reverse


class {{ model_name }}(models.Model):
    """
    {{ model_name }} model for {{ app_name }} app.

    Features:
    - UUID primary key (no enumeration attacks)
    - Automatic timestamps
    - Owner-based permissions
    - Soft delete support

    Usage:
        # Create
        obj = {{ model_name }}.objects.create(title="Example", owner=user)

        # Query with owner
        {{ model_name }}.objects.filter(owner=user, is_active=True)

        # Soft delete
        obj.is_active = False
        obj.save()
    """

    # Primary key - UUID for security
    id = models.UUIDField(
        primary_key=True,
        default=uuid.uuid4,
        editable=False,
        help_text="Unique identifier (UUID v4)"
    )

    # Owner relationship for permissions
    owner = models.ForeignKey(
        settings.AUTH_USER_MODEL,
        on_delete=models.CASCADE,
        related_name='{{ model_name_snake }}s',
        help_text="Owner of this resource"
    )

    # Core fields
    {% for field_name, field_type, options in fields %}
    {% if field_type == 'CharField' %}
    {{ field_name }} = models.CharField(
        max_length={{ options.get('max_length', 200) }},
        {% if options.get('choices') %}
        choices=[{% for choice in options.get('choices', []) %}
            ('{{ choice[0] }}', '{{ choice[1] }}'),
        {% endfor %}],
        default='{{ options.get('default', options.get('choices', [['', '']])[0][0]) }}',
        {% endif %}
        {% if options.get('blank') %}blank=True,{% endif %}
        help_text="{{ field_name|title }} field"
    )
    {% elif field_type == 'TextField' %}
    {{ field_name }} = models.TextField(
        {% if options.get('blank') %}blank=True,{% endif %}
        {% if options.get('default') %}default='{{ options.get('default') }}',{% endif %}
        help_text="{{ field_name|title }} content"
    )
    {% elif field_type == 'BooleanField' %}
    {{ field_name }} = models.BooleanField(
        default={{ options.get('default', True) }},
        help_text="{{ field_name|title }} flag"
    )
    {% elif field_type == 'IntegerField' %}
    {{ field_name }} = models.IntegerField(
        {% if options.get('default') is not none %}default={{ options.get('default') }},{% endif %}
        help_text="{{ field_name|title }} value"
    )
    {% elif field_type == 'DecimalField' %}
    {{ field_name }} = models.DecimalField(
        max_digits={{ options.get('max_digits', 10) }},
        decimal_places={{ options.get('decimal_places', 2) }},
        {% if options.get('default') is not none %}default={{ options.get('default') }},{% endif %}
        help_text="{{ field_name|title }} amount"
    )
    {% elif field_type == 'DateTimeField' %}
    {{ field_name }} = models.DateTimeField(
        {% if options.get('auto_now') %}auto_now=True,{% endif %}
        {% if options.get('auto_now_add') %}auto_now_add=True,{% endif %}
        {% if options.get('null') %}null=True, blank=True,{% endif %}
        help_text="{{ field_name|title }} timestamp"
    )
    {% elif field_type == 'ForeignKey' %}
    {{ field_name }} = models.ForeignKey(
        '{{ options.get('to', 'self') }}',
        on_delete=models.{{ options.get('on_delete', 'CASCADE') }},
        {% if options.get('null') %}null=True, blank=True,{% endif %}
        related_name='{{ model_name_snake }}_{{ field_name }}s',
        help_text="Related {{ field_name }}"
    )
    {% endif %}
    {% endfor %}

    # Timestamps
    created_at = models.DateTimeField(
        auto_now_add=True,
        help_text="Creation timestamp"
    )
    updated_at = models.DateTimeField(
        auto_now=True,
        help_text="Last update timestamp"
    )

    class Meta:
        """Model metadata."""
        verbose_name = '{{ model_name|title }}'
        verbose_name_plural = '{{ model_name|title }}s'
        ordering = ['-created_at']
        indexes = [
            models.Index(fields=['owner', 'is_active']),
            models.Index(fields=['created_at']),
            models.Index(fields=['status']),
        ]

    def __str__(self) -> str:
        """String representation."""
        return f"{self.title}" if hasattr(self, 'title') else f"{{ model_name }} {self.id}"

    def get_absolute_url(self) -> str:
        """Get URL for this object."""
        return reverse('frontend:{{ app_name }}:{{ model_name_snake }}_detail', kwargs={'pk': self.pk})

    def soft_delete(self) -> None:
        """Soft delete this object."""
        self.is_active = False
        self.save(update_fields=['is_active', 'updated_at'])

    @classmethod
    def active_objects(cls):
        """Return only active objects."""
        return cls.objects.filter(is_active=True)
