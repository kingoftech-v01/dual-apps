"""
Django forms for {{ app_name }} app.

ModelForms with:
- Bootstrap/Tailwind styling
- Client-side validation
- HTMX integration

Generated by dual-apps v{{ version }}
"""

from django import forms
from django.core.exceptions import ValidationError

from {{ app_full_name | default(app_name) }}.models import {{ model_name }}


class {{ model_name }}Form(forms.ModelForm):
    """
    Form for creating and editing {{ model_name }}.

    Features:
    - Tailwind CSS classes
    - Client-side validation
    - HTMX-ready

    Usage:
        form = {{ model_name }}Form(request.POST)
        if form.is_valid():
            obj = form.save(commit=False)
            obj.owner = request.user
            obj.save()
    """

    class Meta:
        model = {{ model_name }}
        fields = [
            {% for field_name, field_type, options in fields %}
            '{{ field_name }}',
            {% endfor %}
        ]
        widgets = {
            {% for field_name, field_type, options in fields %}
            {% if field_type == 'CharField' and options.get('max_length', 200) > 100 %}
            '{{ field_name }}': forms.Textarea(attrs={
                'class': 'w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500',
                'rows': 3,
                'placeholder': 'Enter {{ field_name }}...',
            }),
            {% elif field_type == 'TextField' %}
            '{{ field_name }}': forms.Textarea(attrs={
                'class': 'w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500',
                'rows': 5,
                'placeholder': 'Enter {{ field_name }}...',
            }),
            {% elif field_type == 'BooleanField' %}
            '{{ field_name }}': forms.CheckboxInput(attrs={
                'class': 'h-4 w-4 text-indigo-600 focus:ring-indigo-500 border-gray-300 rounded',
            }),
            {% elif options.get('choices') %}
            '{{ field_name }}': forms.Select(attrs={
                'class': 'w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500',
            }),
            {% else %}
            '{{ field_name }}': forms.TextInput(attrs={
                'class': 'w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500',
                'placeholder': 'Enter {{ field_name }}...',
            }),
            {% endif %}
            {% endfor %}
        }

    def clean_title(self):
        """Validate title field."""
        title = self.cleaned_data.get('title', '')
        if len(title) < 3:
            raise ValidationError('Title must be at least 3 characters long.')
        return title.strip()

    def clean(self):
        """Cross-field validation."""
        cleaned_data = super().clean()
        # Add custom validation logic here
        return cleaned_data


class {{ model_name }}SearchForm(forms.Form):
    """
    Search/filter form for {{ model_name }} list.

    Used in list view for filtering.
    """

    search = forms.CharField(
        required=False,
        widget=forms.TextInput(attrs={
            'class': 'w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500',
            'placeholder': 'Search...',
            'hx-get': '/{{ app_name }}/',
            'hx-trigger': 'keyup changed delay:500ms',
            'hx-target': '#item-list',
            'hx-swap': 'innerHTML',
        })
    )

    status = forms.ChoiceField(
        required=False,
        choices=[('', 'All Status')] + list({{ model_name }}._meta.get_field('status').choices),
        widget=forms.Select(attrs={
            'class': 'px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500',
            'hx-get': '/{{ app_name }}/',
            'hx-trigger': 'change',
            'hx-target': '#item-list',
            'hx-swap': 'innerHTML',
        })
    )


class {{ model_name }}BulkActionForm(forms.Form):
    """
    Form for bulk actions on {{ model_name }}.

    Used for bulk archive, delete operations.
    """

    ids = forms.CharField(
        widget=forms.HiddenInput(),
        help_text="Comma-separated list of IDs"
    )

    action = forms.ChoiceField(
        choices=[
            ('archive', 'Archive selected'),
            ('delete', 'Delete selected'),
            ('publish', 'Publish selected'),
        ],
        widget=forms.Select(attrs={
            'class': 'px-3 py-2 border border-gray-300 rounded-md shadow-sm',
        })
    )

    def clean_ids(self):
        """Parse and validate IDs."""
        ids_str = self.cleaned_data.get('ids', '')
        ids = [id.strip() for id in ids_str.split(',') if id.strip()]
        if not ids:
            raise ValidationError('No items selected.')
        return ids
