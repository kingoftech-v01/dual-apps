/**
 * {{ app_name }} - JavaScript utilities
 *
 * HTMX + Alpine.js integration
 * Generated by dual-apps v{{ version }}
 */

// HTMX Configuration
document.addEventListener('DOMContentLoaded', function() {
    // Configure HTMX
    htmx.config.defaultSwapStyle = 'innerHTML';
    htmx.config.historyCacheSize = 10;
    htmx.config.refreshOnHistoryMiss = true;

    // CSRF token for HTMX requests
    document.body.addEventListener('htmx:configRequest', function(evt) {
        const csrfToken = document.querySelector('[name=csrfmiddlewaretoken]');
        if (csrfToken) {
            evt.detail.headers['X-CSRFToken'] = csrfToken.value;
        }
    });

    // Loading indicator
    document.body.addEventListener('htmx:beforeRequest', function(evt) {
        const indicator = document.getElementById('loading-indicator');
        if (indicator) {
            indicator.classList.remove('hidden');
        }
    });

    document.body.addEventListener('htmx:afterRequest', function(evt) {
        const indicator = document.getElementById('loading-indicator');
        if (indicator) {
            indicator.classList.add('hidden');
        }
    });

    // Flash messages auto-dismiss
    const flashMessages = document.querySelectorAll('.flash-message');
    flashMessages.forEach(function(message) {
        setTimeout(function() {
            message.classList.add('fade-out');
            setTimeout(function() {
                message.remove();
            }, 300);
        }, 5000);
    });
});

// Alpine.js components
document.addEventListener('alpine:init', () => {
    // Dropdown component
    Alpine.data('dropdown', () => ({
        open: false,
        toggle() {
            this.open = !this.open;
        },
        close() {
            this.open = false;
        }
    }));

    // Modal component
    Alpine.data('modal', () => ({
        show: false,
        open() {
            this.show = true;
        },
        close() {
            this.show = false;
        }
    }));

    // Bulk selection
    Alpine.data('bulkSelect', () => ({
        selectedIds: [],
        allSelected: false,
        toggleAll(checked) {
            const checkboxes = document.querySelectorAll('.item-checkbox');
            this.selectedIds = [];
            checkboxes.forEach(cb => {
                cb.checked = checked;
                if (checked) {
                    this.selectedIds.push(cb.value);
                }
            });
            this.allSelected = checked;
        },
        toggleItem(id, checked) {
            if (checked) {
                this.selectedIds.push(id);
            } else {
                this.selectedIds = this.selectedIds.filter(i => i !== id);
            }
            this.allSelected = this.selectedIds.length === document.querySelectorAll('.item-checkbox').length;
        }
    }));
});

// Utility functions
const {{ app_name }}Utils = {
    // Format date
    formatDate(dateStr) {
        const date = new Date(dateStr);
        return date.toLocaleDateString('en-US', {
            year: 'numeric',
            month: 'short',
            day: 'numeric'
        });
    },

    // Copy to clipboard
    async copyToClipboard(text) {
        try {
            await navigator.clipboard.writeText(text);
            this.showToast('Copied to clipboard!', 'success');
        } catch (err) {
            console.error('Failed to copy:', err);
        }
    },

    // Toast notification
    showToast(message, type = 'info') {
        const toast = document.createElement('div');
        toast.className = `fixed bottom-4 right-4 px-4 py-2 rounded-lg shadow-lg text-white ${
            type === 'success' ? 'bg-green-500' :
            type === 'error' ? 'bg-red-500' :
            'bg-blue-500'
        }`;
        toast.textContent = message;
        document.body.appendChild(toast);

        setTimeout(() => {
            toast.remove();
        }, 3000);
    },

    // Confirm dialog
    async confirm(message) {
        return window.confirm(message);
    }
};

// Export for global use
window.{{ app_name }}Utils = {{ app_name }}Utils;
