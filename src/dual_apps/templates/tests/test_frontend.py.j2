"""
Frontend view tests for {{ app_name }}.

Tests:
- List view
- Detail view
- Create/Edit forms
- Delete action
- HTMX responses

Generated by dual-apps v{{ version }}
"""

import pytest
from django.urls import reverse
from django.test import Client


class Test{{ model_name }}FrontendList:
    """Tests for {{ model_name }} list view."""

    def test_list_view_authenticated(self, client, regular_user, {{ model_name_snake }}_list):
        """Test list view with authentication."""
        client.force_login(regular_user)
        response = client.get('/{{ app_name }}/')
        assert response.status_code == 200
        assert b'{{ model_name }}' in response.content

    {% if auth_required %}
    def test_list_view_unauthenticated(self, client):
        """Test list view redirects when unauthenticated."""
        response = client.get('/{{ app_name }}/')
        assert response.status_code == 302
        assert 'login' in response.url
    {% else %}
    def test_list_view_unauthenticated(self, client, {{ model_name_snake }}_list):
        """Test list view allows unauthenticated access."""
        response = client.get('/{{ app_name }}/')
        assert response.status_code == 200
    {% endif %}

    def test_list_view_pagination(self, client, regular_user, {{ model_name_snake }}_list):
        """Test list view pagination."""
        client.force_login(regular_user)
        response = client.get('/{{ app_name }}/')
        assert response.status_code == 200
        assert b'page_obj' in response.content or b'Page' in response.content

    def test_list_view_search(self, client, regular_user, {{ model_name_snake }}_list):
        """Test list view search."""
        client.force_login(regular_user)
        response = client.get('/{{ app_name }}/?search=Test')
        assert response.status_code == 200

    def test_list_view_filter_status(self, client, regular_user, {{ model_name_snake }}_list):
        """Test list view status filter."""
        client.force_login(regular_user)
        response = client.get('/{{ app_name }}/?status=active')
        assert response.status_code == 200


class Test{{ model_name }}FrontendDetail:
    """Tests for {{ model_name }} detail view."""

    def test_detail_view(self, client, regular_user, {{ model_name_snake }}):
        """Test detail view."""
        client.force_login(regular_user)
        response = client.get(f'/{{ app_name }}/{{"{"}}{{ model_name_snake }}.id{{"}"}}/')
        assert response.status_code == 200
        assert {{ model_name_snake }}.title.encode() in response.content

    def test_detail_view_not_found(self, client, regular_user):
        """Test detail view for non-existent item."""
        import uuid
        client.force_login(regular_user)
        response = client.get(f'/{{ app_name }}/{uuid.uuid4()}/')
        assert response.status_code == 404


class Test{{ model_name }}FrontendCreate:
    """Tests for {{ model_name }} create view."""

    def test_create_view_get(self, client, regular_user):
        """Test create view GET."""
        client.force_login(regular_user)
        response = client.get('/{{ app_name }}/create/')
        assert response.status_code == 200
        assert b'form' in response.content

    def test_create_view_post(self, client, regular_user):
        """Test create view POST."""
        client.force_login(regular_user)
        data = {
            'title': 'New Test Item',
            'description': 'Test description',
            'status': 'draft',
            'is_active': True,
        }
        response = client.post('/{{ app_name }}/create/', data)
        assert response.status_code == 302  # Redirect on success

    def test_create_view_validation_error(self, client, regular_user):
        """Test create view with invalid data."""
        client.force_login(regular_user)
        data = {'title': 'AB', 'status': 'draft'}  # Title too short
        response = client.post('/{{ app_name }}/create/', data)
        assert response.status_code == 200  # Returns form with errors

    def test_create_view_unauthenticated(self, client):
        """Test create view requires authentication."""
        response = client.get('/{{ app_name }}/create/')
        assert response.status_code == 302
        assert 'login' in response.url


class Test{{ model_name }}FrontendEdit:
    """Tests for {{ model_name }} edit view."""

    def test_edit_view_get_own(self, client, regular_user, {{ model_name_snake }}):
        """Test edit view GET for own item."""
        client.force_login(regular_user)
        response = client.get(f'/{{ app_name }}/{{"{"}}{{ model_name_snake }}.id{{"}"}}/edit/')
        assert response.status_code == 200
        assert {{ model_name_snake }}.title.encode() in response.content

    def test_edit_view_post_own(self, client, regular_user, {{ model_name_snake }}):
        """Test edit view POST for own item."""
        client.force_login(regular_user)
        data = {
            'title': 'Updated Title',
            'description': 'Updated description',
            'status': 'active',
            'is_active': True,
        }
        response = client.post(f'/{{ app_name }}/{{"{"}}{{ model_name_snake }}.id{{"}"}}/edit/', data)
        assert response.status_code == 302  # Redirect on success

    def test_edit_view_other_user_denied(self, client, regular_user, other_user_{{ model_name_snake }}):
        """Test edit view denies access to other user's item."""
        client.force_login(regular_user)
        response = client.get(f'/{{ app_name }}/{other_user_{{ model_name_snake }}.id}/edit/')
        assert response.status_code == 302  # Redirect with error


class Test{{ model_name }}FrontendDelete:
    """Tests for {{ model_name }} delete view."""

    def test_delete_view_own(self, client, regular_user, {{ model_name_snake }}):
        """Test delete view for own item."""
        client.force_login(regular_user)
        response = client.post(f'/{{ app_name }}/{{"{"}}{{ model_name_snake }}.id{{"}"}}/delete/')
        assert response.status_code == 302  # Redirect on success

    def test_delete_view_other_user_denied(self, client, regular_user, other_user_{{ model_name_snake }}):
        """Test delete view denies access to other user's item."""
        client.force_login(regular_user)
        response = client.post(f'/{{ app_name }}/{other_user_{{ model_name_snake }}.id}/delete/')
        assert response.status_code == 302  # Redirect with error

    def test_delete_view_get_not_allowed(self, client, regular_user, {{ model_name_snake }}):
        """Test delete view does not allow GET."""
        client.force_login(regular_user)
        response = client.get(f'/{{ app_name }}/{{"{"}}{{ model_name_snake }}.id{{"}"}}/delete/')
        assert response.status_code == 405  # Method not allowed


class Test{{ model_name }}FrontendHTMX:
    """Tests for HTMX functionality."""

    def test_htmx_list_response(self, client, regular_user, {{ model_name_snake }}_list):
        """Test HTMX partial response for list."""
        client.force_login(regular_user)
        response = client.get(
            '/{{ app_name }}/',
            HTTP_HX_REQUEST='true'
        )
        assert response.status_code == 200
        # Should return partial HTML, not full page

    def test_htmx_delete_response(self, client, regular_user, {{ model_name_snake }}):
        """Test HTMX response for delete."""
        client.force_login(regular_user)
        response = client.post(
            f'/{{ app_name }}/{{"{"}}{{ model_name_snake }}.id{{"}"}}/delete/',
            HTTP_HX_REQUEST='true'
        )
        assert response.status_code == 204  # No content
        assert 'HX-Redirect' in response
