"""
Pytest fixtures for {{ app_name }} tests.

Provides:
- User fixtures (regular, staff, superuser)
- API client fixtures (authenticated, anonymous)
- Model fixtures (demo data)

Generated by dual-apps v{{ version }}
"""

import pytest
from django.contrib.auth import get_user_model
from rest_framework.test import APIClient

from {{ app_name }}.models import {{ model_name }}


User = get_user_model()


# =============================================================================
# User Fixtures
# =============================================================================

@pytest.fixture
def regular_user(db):
    """Create a regular user for testing."""
    user = User.objects.create_user(
        username='testuser',
        email='testuser@example.com',
        password='testpass123'
    )
    return user


@pytest.fixture
def other_user(db):
    """Create another user for permission tests."""
    user = User.objects.create_user(
        username='otheruser',
        email='other@example.com',
        password='testpass123'
    )
    return user


@pytest.fixture
def staff_user(db):
    """Create a staff user for testing."""
    user = User.objects.create_user(
        username='staffuser',
        email='staff@example.com',
        password='testpass123',
        is_staff=True
    )
    return user


@pytest.fixture
def superuser(db):
    """Create a superuser for testing."""
    user = User.objects.create_superuser(
        username='admin',
        email='admin@example.com',
        password='adminpass123'
    )
    return user


# =============================================================================
# Client Fixtures
# =============================================================================

@pytest.fixture
def api_client():
    """Create an API client."""
    return APIClient()


@pytest.fixture
def authenticated_client(api_client, regular_user):
    """Create an authenticated API client."""
    api_client.force_authenticate(user=regular_user)
    return api_client


@pytest.fixture
def staff_client(api_client, staff_user):
    """Create a staff-authenticated API client."""
    api_client.force_authenticate(user=staff_user)
    return api_client


@pytest.fixture
def superuser_client(api_client, superuser):
    """Create a superuser-authenticated API client."""
    api_client.force_authenticate(user=superuser)
    return api_client


# =============================================================================
# Model Fixtures
# =============================================================================

@pytest.fixture
def {{ model_name_snake }}(db, regular_user):
    """Create a single {{ model_name }} for testing."""
    return {{ model_name }}.objects.create(
        title='Test {{ model_name }}',
        description='Test description',
        status='active',
        owner=regular_user,
    )


@pytest.fixture
def {{ model_name_snake }}_draft(db, regular_user):
    """Create a draft {{ model_name }} for testing."""
    return {{ model_name }}.objects.create(
        title='Draft {{ model_name }}',
        description='Draft description',
        status='draft',
        owner=regular_user,
    )


@pytest.fixture
def {{ model_name_snake }}_archived(db, regular_user):
    """Create an archived {{ model_name }} for testing."""
    return {{ model_name }}.objects.create(
        title='Archived {{ model_name }}',
        description='Archived description',
        status='archived',
        is_active=False,
        owner=regular_user,
    )


@pytest.fixture
def other_user_{{ model_name_snake }}(db, other_user):
    """Create a {{ model_name }} owned by another user."""
    return {{ model_name }}.objects.create(
        title='Other User {{ model_name }}',
        description='Owned by other user',
        status='active',
        owner=other_user,
    )


@pytest.fixture
def {{ model_name_snake }}_list(db, regular_user):
    """Create multiple {{ model_name }}s for list testing."""
    items = []
    for i in range(25):
        item = {{ model_name }}.objects.create(
            title=f'Test {{ model_name }} {i+1}',
            description=f'Description {i+1}',
            status=['draft', 'active', 'active', 'active', 'archived'][i % 5],
            is_active=i % 5 != 4,
            owner=regular_user,
        )
        items.append(item)
    return items


# =============================================================================
# URL Fixtures
# =============================================================================

@pytest.fixture
def api_list_url():
    """API list endpoint URL."""
    return '/api/v1/{{ app_name }}/{{ model_name_kebab }}s/'


@pytest.fixture
def api_detail_url({{ model_name_snake }}):
    """API detail endpoint URL."""
    return f'/api/v1/{{ app_name }}/{{ model_name_kebab }}s/{ {{ model_name_snake }}.id}/'


@pytest.fixture
def frontend_list_url():
    """Frontend list URL."""
    return '/{{ app_name }}/'


@pytest.fixture
def frontend_detail_url({{ model_name_snake }}):
    """Frontend detail URL."""
    return f'/{{ app_name }}/{ {{ model_name_snake }}.id}/'
