"""
Pytest configuration for {{ project_name }} integration tests.
Generated by dual-apps v{{ version }}
"""

import pytest
from django.contrib.auth import get_user_model
from django.test import Client
from rest_framework.test import APIClient

User = get_user_model()


@pytest.fixture
def user(db):
    """Create a regular test user."""
    return User.objects.create_user(
        username="testuser",
        email="test@example.com",
        password="testpass123"
    )


@pytest.fixture
def admin_user(db):
    """Create an admin test user."""
    return User.objects.create_superuser(
        username="admin",
        email="admin@example.com",
        password="adminpass123"
    )


@pytest.fixture
def client():
    """Django test client."""
    return Client()


@pytest.fixture
def auth_client(user):
    """Authenticated Django test client."""
    client = Client()
{% if use_allauth %}
    client.login(email="test@example.com", password="testpass123")
{% else %}
    client.login(username="testuser", password="testpass123")
{% endif %}
    return client


@pytest.fixture
def api_client():
    """DRF API test client."""
    return APIClient()


@pytest.fixture
def auth_api_client(user, api_client):
    """Authenticated DRF API test client."""
    api_client.force_authenticate(user=user)
    return api_client


@pytest.fixture
def admin_api_client(admin_user, api_client):
    """Admin authenticated DRF API test client."""
    api_client.force_authenticate(user=admin_user)
    return api_client


{% for app in apps_config %}
# {{ app.name_title }} fixtures
@pytest.fixture
def {{ app.name }}_data(user):
    """Sample data for {{ app.name_title }}."""
    return {
        "title": "Test {{ app.name_title }}",
        "description": "Test description for {{ app.name }}",
    }


@pytest.fixture
def {{ app.name }}_instance(db, user, {{ app.name }}_data):
    """Create a {{ app.name_title }} instance."""
    from apps.{{ app.name }}.models import {{ app.name_pascal }}
    return {{ app.name_pascal }}.objects.create(owner=user, **{{ app.name }}_data)

{% endfor %}
