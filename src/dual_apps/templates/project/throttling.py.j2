"""
API throttling configuration for {{ project_name }}.
Generated by dual-apps v{{ version }}

Custom throttle classes for DRF.
"""

from rest_framework.throttling import UserRateThrottle, AnonRateThrottle


class BurstRateThrottle(UserRateThrottle):
    """
    Throttle for burst requests.

    Allows short bursts of requests.
    Default: 60 requests per minute.
    """
    scope = 'burst'
    rate = '60/min'


class SustainedRateThrottle(UserRateThrottle):
    """
    Throttle for sustained requests.

    Limits total requests over longer period.
    Default: 1000 requests per day.
    """
    scope = 'sustained'
    rate = '1000/day'


class AnonBurstRateThrottle(AnonRateThrottle):
    """
    Throttle for anonymous burst requests.

    More restrictive for unauthenticated users.
    Default: 20 requests per minute.
    """
    scope = 'anon_burst'
    rate = '20/min'


class AnonSustainedRateThrottle(AnonRateThrottle):
    """
    Throttle for anonymous sustained requests.

    Default: 100 requests per day.
    """
    scope = 'anon_sustained'
    rate = '100/day'


class WriteRateThrottle(UserRateThrottle):
    """
    Throttle for write operations (POST, PUT, PATCH, DELETE).

    More restrictive than read operations.
    Default: 30 writes per minute.
    """
    scope = 'write'
    rate = '30/min'

    def allow_request(self, request, view):
        if request.method in ('GET', 'HEAD', 'OPTIONS'):
            return True
        return super().allow_request(request, view)


class LoginRateThrottle(AnonRateThrottle):
    """
    Throttle for login attempts.

    Prevents brute force attacks.
    Default: 5 attempts per minute.
    """
    scope = 'login'
    rate = '5/min'


class PasswordResetThrottle(AnonRateThrottle):
    """
    Throttle for password reset requests.

    Default: 3 requests per hour.
    """
    scope = 'password_reset'
    rate = '3/hour'


# DRF Settings (add to settings/base.py)
THROTTLE_SETTINGS = {
    'DEFAULT_THROTTLE_CLASSES': [
        '{{ project_name }}.throttling.BurstRateThrottle',
        '{{ project_name }}.throttling.SustainedRateThrottle',
    ],
    'DEFAULT_THROTTLE_RATES': {
        'burst': '60/min',
        'sustained': '1000/day',
        'anon_burst': '20/min',
        'anon_sustained': '100/day',
        'write': '30/min',
        'login': '5/min',
        'password_reset': '3/hour',
    }
}
