# Django-Allauth Settings for {{ project_name }}
# Generated by dual-apps v{{ version }}
#
# Add these to your INSTALLED_APPS and configure as needed.

# =============================================================================
# INSTALLED_APPS additions
# =============================================================================
ALLAUTH_APPS = [
    # Django contrib
    "django.contrib.sites",

    # Allauth
    "allauth",
    "allauth.account",
    "allauth.socialaccount",
{% if social_providers %}
    # Social providers
{% for provider in social_providers %}
    "allauth.socialaccount.providers.{{ provider }}",
{% endfor %}
{% endif %}
]

# Add to INSTALLED_APPS:
# INSTALLED_APPS = [
#     ...
#     *ALLAUTH_APPS,
# ]

# =============================================================================
# Site ID (required for allauth)
# =============================================================================
SITE_ID = 1

# =============================================================================
# Authentication backends
# =============================================================================
AUTHENTICATION_BACKENDS = [
    # Django default
    "django.contrib.auth.backends.ModelBackend",
    # Allauth
    "allauth.account.auth_backends.AuthenticationBackend",
]

# =============================================================================
# Allauth Account Settings
# =============================================================================

# Login/Logout
LOGIN_URL = "/accounts/login/"
LOGIN_REDIRECT_URL = "/"
LOGOUT_REDIRECT_URL = "/"
ACCOUNT_LOGOUT_ON_GET = False  # Require POST for logout

# Registration
ACCOUNT_AUTHENTICATION_METHOD = "{{ auth_method | default('email') }}"  # 'email', 'username', or 'username_email'
ACCOUNT_EMAIL_REQUIRED = True
ACCOUNT_USERNAME_REQUIRED = {{ 'True' if auth_method == 'username' else 'False' }}
ACCOUNT_UNIQUE_EMAIL = True

# Email verification
ACCOUNT_EMAIL_VERIFICATION = "{{ email_verification | default('mandatory') }}"  # 'mandatory', 'optional', or 'none'
ACCOUNT_EMAIL_CONFIRMATION_EXPIRE_DAYS = 3
ACCOUNT_EMAIL_CONFIRMATION_COOLDOWN = 180  # seconds

# Password
ACCOUNT_PASSWORD_MIN_LENGTH = 8
ACCOUNT_PASSWORD_INPUT_RENDER_VALUE = False

# Sessions
ACCOUNT_SESSION_REMEMBER = True  # Remember me checkbox
ACCOUNT_LOGIN_ON_EMAIL_CONFIRMATION = True
ACCOUNT_LOGIN_ON_PASSWORD_RESET = True

# Rate limiting
ACCOUNT_RATE_LIMITS = {
    "login_failed": "5/5m",  # 5 attempts per 5 minutes
    "signup": "20/1h",       # 20 signups per hour
}

# User model
# ACCOUNT_USER_MODEL_USERNAME_FIELD = "username"
# ACCOUNT_USER_MODEL_EMAIL_FIELD = "email"

# Forms customization (optional)
# ACCOUNT_FORMS = {
#     "login": "{{ project_name }}.forms.CustomLoginForm",
#     "signup": "{{ project_name }}.forms.CustomSignupForm",
# }

# Adapters (optional)
# ACCOUNT_ADAPTER = "{{ project_name }}.adapters.CustomAccountAdapter"
# SOCIALACCOUNT_ADAPTER = "{{ project_name }}.adapters.CustomSocialAccountAdapter"

# =============================================================================
# Social Account Settings
# =============================================================================
{% if social_providers %}
SOCIALACCOUNT_AUTO_SIGNUP = True
SOCIALACCOUNT_EMAIL_REQUIRED = True
SOCIALACCOUNT_EMAIL_VERIFICATION = "none"  # Already verified by provider
SOCIALACCOUNT_QUERY_EMAIL = True
SOCIALACCOUNT_STORE_TOKENS = True

# Provider-specific settings
SOCIALACCOUNT_PROVIDERS = {
{% if 'google' in social_providers %}
    "google": {
        "SCOPE": ["profile", "email"],
        "AUTH_PARAMS": {"access_type": "online"},
        "APP": {
            "client_id": os.environ.get("GOOGLE_CLIENT_ID", ""),
            "secret": os.environ.get("GOOGLE_CLIENT_SECRET", ""),
            "key": "",
        },
    },
{% endif %}
{% if 'github' in social_providers %}
    "github": {
        "SCOPE": ["user:email"],
        "APP": {
            "client_id": os.environ.get("GITHUB_CLIENT_ID", ""),
            "secret": os.environ.get("GITHUB_CLIENT_SECRET", ""),
            "key": "",
        },
    },
{% endif %}
{% if 'facebook' in social_providers %}
    "facebook": {
        "METHOD": "oauth2",
        "SCOPE": ["email", "public_profile"],
        "FIELDS": ["email", "name", "first_name", "last_name"],
        "APP": {
            "client_id": os.environ.get("FACEBOOK_CLIENT_ID", ""),
            "secret": os.environ.get("FACEBOOK_CLIENT_SECRET", ""),
            "key": "",
        },
    },
{% endif %}
{% if 'twitter' in social_providers %}
    "twitter": {
        "APP": {
            "client_id": os.environ.get("TWITTER_CLIENT_ID", ""),
            "secret": os.environ.get("TWITTER_CLIENT_SECRET", ""),
            "key": "",
        },
    },
{% endif %}
{% if 'apple' in social_providers %}
    "apple": {
        "APP": {
            "client_id": os.environ.get("APPLE_CLIENT_ID", ""),
            "secret": os.environ.get("APPLE_CLIENT_SECRET", ""),
            "key": os.environ.get("APPLE_KEY_ID", ""),
            "certificate_key": os.environ.get("APPLE_CERTIFICATE_KEY", ""),
        },
    },
{% endif %}
}
{% endif %}

# =============================================================================
# Middleware
# =============================================================================
# Add to MIDDLEWARE:
# "allauth.account.middleware.AccountMiddleware",

import os  # noqa: E402
